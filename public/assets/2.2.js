webpackJsonp([2],{748:function(e,t,a){var n=a(843);"string"==typeof n&&(n=[[e.id,n,""]]),a(123)(n,{}),n.locals&&(e.exports=n.locals)},764:function(e,t,a){(function(n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a(46),i=r.Tabs.TabPane,o=a(766),l=a(765),s=n.createClass({displayName:"Monitor",getInitialState:function(){return{}},componentWillMount:function(){console.log("componentWillMount")},componentDidMount:function(){},callback:function(e){},render:function(){return n.createElement("div",{className:"ant-panel-box"},n.createElement("h2",{className:"ant-panel-title"},"服务器监控"),n.createElement(r.Tabs,{defaultActiveKey:"1",onChange:this.callback},n.createElement(i,{tab:"服务器状态",key:"1"},n.createElement(o,null)),n.createElement(i,{tab:"API失败率",key:"2"},n.createElement(l,null))))}});t["default"]=s,e.exports=t["default"]}).call(t,a(1))},765:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var r=a(1),i=n(r),o=a(46),l=a(122),s=n(l),d=a(3),c=n(d);a(748);var m=o.DatePicker.RangePicker,u=i["default"].createClass({displayName:"MonitorApiRate",getInitialState:function(){return{loading:!1,start_time:(0,c["default"])().subtract(7,"day").format("YYYY-MM-DD"),end_time:(0,c["default"])().format("YYYY-MM-DD"),data:[]}},componentWillMount:function(){console.log("componentWillMount")},componentDidMount:function(){this.fetchData({start_time:this.state.start_time,end_time:this.state.end_time})},fetchData:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];console.info("获取数据中"+this.state.start_time+","+this.state.end_time),this.setState({loading:!0}),(0,s["default"])({url:"http://pikachu.monitor.dayugame.net/fetch_login_api_rate",method:"get",data:t,crossOrigin:!0,type:"json",success:function(t){e.setState({loading:!1,data:t})}})},onChangeDate:function(e){var t=(0,c["default"])(e[0]).format("YYYY-MM-DD"),a=(0,c["default"])(e[1]).format("YYYY-MM-DD");this.setState({start_time:t,end_time:a}),this.fetchData({start_time:t,end_time:a})},disabledDate:function(e){return e&&e.getTime()>Date.now()},renderPercent:function(e,t,a){var n="";return n=e>95?"text-bold  ":"text-bold text-danger",i["default"].createElement("span",{className:n}," ",e?(100-e).toFixed(2)+"%":"")},getPercentColor:function(e){var t=arguments.length<=1||void 0===arguments[1]?30:arguments[1],a=arguments.length<=2||void 0===arguments[2]?60:arguments[2],n=arguments.length<=3||void 0===arguments[3]?80:arguments[3];return e>n?"#FF5500":e>a?"#ff820b":e>t?"#2DB7F5":"#87D068"},render:function(){var e=[];this.state.data.map(function(t){t.info.time=t.time,t.info.key=t.time,e.unshift(t.info)});var t=[{title:"日期",sorter:function(e,t){return e.time-t.time},dataIndex:"time",className:"text-bold",key:"time",width:110},{title:"version",dataIndex:"version",key:"version",className:"text-right",render:this.renderPercent},{title:"iosconfig",dataIndex:"iosconfig",key:"iosconfig",className:"text-right",render:this.renderPercent},{title:"socket",dataIndex:"socket",key:"socket",className:"text-right",render:this.renderPercent},{title:"servers",dataIndex:"servers",key:"servers",className:"text-right ",render:this.renderPercent}];return i["default"].createElement("div",null,i["default"].createElement("div",null,i["default"].createElement(m,{style:{width:184},format:"yyyy-MM-dd",value:[this.state.start_time,this.state.end_time],disabledDate:this.disabledDate,onChange:this.onChangeDate})),i["default"].createElement("div",{style:{marginTop:10}},i["default"].createElement(o.Table,{dataSource:e,columns:t,loading:this.state.loading})))}});e.exports=u},766:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}var r=a(1),i=n(r),o=a(46),l=a(10),s=(n(l),a(122)),d=n(s),c=a(3),m=n(c);a(748);var u=a(231).Line,f=i["default"].createClass({displayName:"MonitorTable",getInitialState:function(){return{loading:!1,auto:!1,date:(0,m["default"])().format("YYYY-MM-DD HH:mm:ss"),timer:null,seconds:60,data:{server:[]}}},componentWillMount:function(){console.log("MonitorTable componentWillMount"),this.isMount=!0},componentWillUnmount:function(){console.log("MonitorTable componentWillUnmount"),clearTimeout(this.timer),this.isMount=!1},componentDidMount:function(){this.fetchData(),console.log("MonitorTable componentDidMount")},setNewDateAndUpdate:function(){var e=(0,m["default"])().format("YYYY-MM-DD HH:mm:ss");this.setState({date:e}),this.fetchData({time:e})},fetchData:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{time:this.state.date}:arguments[0];console.info("获取数据中"+this.state.date),console.log(this.state.auto),this.setState({loading:!0}),(0,d["default"])({url:"http://pikachu.monitor.dayugame.net/fetch_server_status",method:"get",data:{length:1,hostname_list:"all",time_internal:1,time:t.time},crossOrigin:!0,type:"json",success:function(t){t.length>0&&e.isMount&&(e.setState({loading:!1,seconds:60,data:t[0]}),e.state.auto?e.startNewTimer():clearTimeout(e.timer))}})},updateTimer:function(){if(0==this.state.seconds)clearTimeout(this.timer),this.setNewDateAndUpdate();else if(this.state.seconds>0){var e=this.state.seconds-1;this.setState({seconds:e})}else this.setState({seconds:0})},startNewTimer:function(){var e=this;this.timer&&clearTimeout(this.timer),this.timer=setInterval(function(){e.updateTimer()},1e3)},onChangeAutoUpdate:function(e){e?(this.setState({auto:!0,seconds:60}),this.startNewTimer()):this.timer&&(clearTimeout(this.timer),this.setState({auto:!1}))},onChangeDate:function(e){var t=(0,m["default"])(e).format("YYYY-MM-DD HH:mm:ss");this.setState({auto:!1,date:t}),this.fetchData({time:t})},disabledDate:function(e){return e&&e.getTime()>Date.now()},expandedRowRender:function(e){var t=["tsm","tsw","tss_tsm","tss_tsw","tsd","tsl","mysql"],a=t.map(function(t){return i["default"].createElement(o.Row,{key:t},i["default"].createElement(o.Col,{span:"3",className:"text-right"}," ",i["default"].createElement(o.Icon,{type:"laptop"})," ",i["default"].createElement("b",null," ",t," ")," "),i["default"].createElement(o.Col,{span:"3",className:"text-right"},"  ",e[t+"_cpu_time_percent"],"%    "),i["default"].createElement(o.Col,{span:"3",className:"text-right"},"  ",e[t+"_mem_percent"],"%    "),i["default"].createElement(o.Col,{span:"3",className:"text-right"},"  ",e[t+"_num_threads"],"   "),i["default"].createElement(o.Col,{span:"3",className:"text-right"},"  ",e[t+"_io_read_count"],"    "),i["default"].createElement(o.Col,{span:"3",className:"text-right"},"  ",e[t+"_io_write_count"],"    "))});return i["default"].createElement("div",null," ",i["default"].createElement(o.Row,null,i["default"].createElement(o.Col,{span:"3",className:"text-right text-bold"}," 进程 "),i["default"].createElement(o.Col,{span:"3",className:"text-right text-bold"}," CPU"),i["default"].createElement(o.Col,{span:"3",className:"text-right text-bold"}," 内存   "),i["default"].createElement(o.Col,{span:"3",className:"text-right text-bold"}," 线程数  "),i["default"].createElement(o.Col,{span:"3",className:"text-right text-bold"}," 磁盘IO读数  "),i["default"].createElement(o.Col,{span:"3",className:"text-right text-bold"}," 磁盘IO写数  ")),a,"   ")},renderRowName:function(e,t,a){return i["default"].createElement("span",{className:""},i["default"].createElement(o.Icon,{type:"hdd"})," ",e)},renderPercent:function(e,t,a){var n="";return e>80?n="text-danger text-bold":e>60?n="text-warning text-bold":30>e&&(n="text-default"),i["default"].createElement("span",{className:n}," ",e,"%")},renderCpuUseage:function(e,t,a){var n=this.getPercentColor(t.cpu_user,50,80,90);return i["default"].createElement("div",null,i["default"].createElement(u,{percent:t.cpu_user,strokeWidth:3,trailColor:"#f3f3f3",strokeColor:n}),i["default"].createElement("span",{className:"text-bold",style:{color:n}}," ",t.cpu_user,"% "),i["default"].createElement(o.Tooltip,{title:"CPU负载:"+t.cpu_percent+"%,系统:"+t.cpu_system+"%, 逻辑进程:"+t.cpu_user+"%, 空闲:"+t.cpu_idle+"%",placement:"bottomRight"},i["default"].createElement("b",null," CPU  ",i["default"].createElement(o.Icon,{type:"info-circle-o"}))))},renderMemUseage:function(e,t,a){var n=this.getPercentColor(t.mem_percent);return i["default"].createElement("div",null,i["default"].createElement(u,{percent:t.mem_percent,strokeWidth:3,trailColor:"#f3f3f3",strokeColor:n}),i["default"].createElement("span",{className:"text-bold",style:{color:n}}," ",t.mem_used," ")," ",i["default"].createElement("span",{className:"text-default"},"/ ",t.mem_total),i["default"].createElement(o.Tooltip,{title:"使用率:"+t.mem_percent+"%, 剩余可用:"+t.mem_available,placement:"bottomRight"},i["default"].createElement("b",null," 内存  ",i["default"].createElement(o.Icon,{type:"info-circle-o"}))))},renderDiskUseage:function(e,t,a){var n=this.getPercentColor(t.disk_percent);return i["default"].createElement("div",null,i["default"].createElement(u,{percent:t.disk_percent,strokeWidth:3,trailColor:"#f3f3f3",strokeColor:n}),i["default"].createElement("span",{className:"text-bold",style:{color:n}}," ",t.disk_used," ")," ",i["default"].createElement("span",{className:"text-default"},"/ ",t.disk_total),i["default"].createElement(o.Tooltip,{title:"使用率:"+t.disk_percent+"%, 剩余可用:"+t.disk_free,placement:"bottomRight"},i["default"].createElement("b",null," 磁盘  ",i["default"].createElement(o.Icon,{type:"info-circle-o"}))))},getPercentColor:function(e){var t=arguments.length<=1||void 0===arguments[1]?30:arguments[1],a=arguments.length<=2||void 0===arguments[2]?75:arguments[2],n=arguments.length<=3||void 0===arguments[3]?85:arguments[3];return e>n?"#FF5500":e>a?"#ff820b":e>t?"#2DB7F5":"#87D068"},render:function(){var e=[];this.state.data.server.map(function(t){t.info.name=t.name,t.info.key=t.name,e.push(t.info)});var t=[{title:"服务器",dataIndex:"name",className:"text-bold",key:"name",width:110,render:this.renderRowName,filters:[{text:"tw",value:"tw"},{text:"en",value:"en"}],onFilter:function(e,t){return t.name.indexOf(e)>-1}},{title:"IO等待",sorter:function(e,t){return e.cpu_iowait-t.cpu_iowait},dataIndex:"cpu_iowait",width:80,key:"cpu_iowait",className:"text-right",render:this.renderPercent},{title:"CPU负载",sorter:function(e,t){return e.cpu_percent-t.cpu_percent},dataIndex:"cpu_percent",width:260,key:"cpu",className:"text-right mt-chart-padding",render:this.renderCpuUseage},{title:"内存",sorter:function(e,t){return e.mem_percent-t.mem_percent},dataIndex:"mem_percent",width:260,key:"mem",className:"text-right mt-chart-padding",render:this.renderMemUseage},{title:"磁盘",sorter:function(e,t){return e.disk_percent-t.disk_percent},dataIndex:"disk_total",width:260,key:"disk",className:"text-right mt-chart-padding",render:this.renderDiskUseage}],a=this.state.loading?"正在刷新":i["default"].createElement("span",null,i["default"].createElement("span",null,"倒计时 "),i["default"].createElement("b",{className:"text-danger"},this.state.seconds)," 秒"),n=0==this.state.auto?i["default"].createElement(o.Button,{type:"primary",size:"small",onClick:this.setNewDateAndUpdate},"刷新 "):a;return i["default"].createElement("div",null,i["default"].createElement("div",null,i["default"].createElement(o.DatePicker,{value:this.state.date,format:"yyyy-MM-dd HH:mm:ss",disabledDate:this.disabledDate,showTime:!0,onChange:this.onChangeDate}),i["default"].createElement("span",{style:{marginLeft:10}},this.state.auto?i["default"].createElement("span",{className:"text-primary"},"自动刷新"):"自动刷新"),i["default"].createElement(o.Switch,{style:{marginLeft:4},size:"small",checked:this.state.auto,onChange:this.onChangeAutoUpdate}),i["default"].createElement("span",{style:{marginLeft:10}}," ",n)),i["default"].createElement("div",{style:{marginTop:10}},i["default"].createElement(o.Table,{dataSource:e,columns:t,loading:this.state.loading,pagination:!1,expandedRowRender:this.expandedRowRender})))}});e.exports=f},843:function(e,t,a){t=e.exports=a(117)(),t.push([e.id,".advanced-search-form{padding:16px 8px;background:#f8f8f8;border:1px solid #d9d9d9;border-radius:6px}.monitor-table{margin-left:100px;font-size:12px;text-align:left;overflow-x:scroll}.monitor-table,.mt{border-collapse:separate}.mt{border-spacing:0;table-layout:fixed;white-space:nowrap}.mt tbody tr,.mt thead tr{position:relative;height:40px;line-height:40px}.mt tbody th:first-child,.mt thead th:first-child{border-bottom:1px solid #efefef;padding:0 10px;min-width:100px;margin-left:-100px;position:absolute;z-index:100;background:#fafafa;text-align:right;color:#0077a2}.mt thead{text-align:center}.mt tr.mt-head{height:30px;line-height:30px}.mt tr.mt-head td,.mt tr.mt-head th{font-weight:900;background:#fff;border-left:1px solid #efefef}.mt td.border-right,.mt th.border-right{border-right:1px solid #9e9e9e}.mt tr.mt-head-sub td,.mt tr.mt-head-sub th{padding:0 15px;text-align:center;background:#fafafa;font-weight:900;border-top:1px solid #efefef;border-bottom:1px solid #9e9e9e}.mt tr.mt-condensed{height:30px;line-height:30px}.mt tr.mt-divider td,.mt tr.mt-divider th{border-top:1px solid #e2e2e2}.mt tbody td{min-width:80px;border-bottom:1px solid #efefef;padding:0 10px;text-align:center}.mt tbody tr th{border-right:1px solid #efefef}.mt tbody tr td:nth-of-type(odd){background:#fbfbfb}.mt tbody tr td:nth-of-type(even){background:#fff}.mt tbody tr:hover td{background:#fcfcfc!important}.mt tbody tr:hover td:nth-of-type(odd){background:#f1f1f1!important}.mt tbody tr:hover th{background:#fafafa!important;color:#19a136!important}.monitor-fixed-table .monitor-table{overflow:hidden}.monitor-fixed-table.fixed{position:fixed;z-index:200}.monitor-fixed-table.hide{display:none}.monitor-fixed-table tr th:first-child{position:absolute;z-index:300}.text-bold{font-weight:900}.text-primary{color:#2db7f5}.text-success{color:#87d068}.text-default{color:#adadad}.text-warning{color:#ff820b}.text-danger{color:#f50}.text-right{text-align:right!important}.mt-chart-padding{padding:0 30px!important}",""])}});